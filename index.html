<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>每月工時與薪資計算器</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 Noto Sans TC 字體 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* 設定預設字體 */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8;
        }
        /* 自定義日曆網格樣式 */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, minmax(0, 1fr));
            border-left: 1px solid #e2e8f0;
            border-top: 1px solid #e2e8f0;
        }
        .day-cell {
            border-right: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            padding: 8px;
            min-height: 120px;
            background-color: white;
            transition: all 0.2s;
            position: relative; /* 用於定位 */
        }
        .day-cell:hover {
            background-color: #f7fafc;
        }
        /* 跳過狀態的樣式 */
        .day-cell.skipped-day {
            background-color: #f3f4f6 !important; /* gray-100 */
        }
        
        .day-header {
            text-align: center;
            font-weight: 700;
            padding: 10px 0;
            background-color: #4c51bf; /* Indigo/Blue for headers */
            color: white;
            border-right: 1px solid #667eea;
        }
        .day-header:last-child {
            border-right: none;
        }
        
        /* 響應式調整 */
        @media (max-width: 768px) {
            .day-cell {
                min-height: 100px;
                padding: 4px;
            }
            .time-input {
                font-size: 0.75rem; /* text-xs */
                padding: 4px;
            }
        }

        /* --- 列印專用樣式 (A4 優化) --- */
        @media print {
            @page {
                size: A4; /* 設定紙張大小為 A4 */
                margin: 1cm; /* 設定邊界 */
            }
            body {
                background-color: white;
                font-size: 10pt; /*稍微縮小字體以塞入一頁*/
                -webkit-print-color-adjust: exact; /* 強制列印背景色(如果瀏覽器支援) */
                print-color-adjust: exact;
            }
            
            /* 隱藏列印時不需要的元素 */
            .no-print, button, nav, .month-nav-btn {
                display: none !important;
            }
            
            /* 調整容器 */
            .max-w-6xl {
                max-width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            
            /* 標題調整 */
            h1 {
                font-size: 18pt !important;
                margin-bottom: 10px !important;
                text-align: center;
                border-bottom: 2px solid #000 !important;
                padding-bottom: 5px !important;
                color: #000 !important;
            }
            
            /* 導航列調整：隱藏按鈕，只留年份月份文字 */
            .nav-container {
                box-shadow: none !important;
                background: none !important;
                margin-bottom: 10px !important;
                padding: 0 !important;
                justify-content: center !important;
            }
            .nav-container select {
                border: none !important;
                font-size: 14pt !important;
                font-weight: bold !important;
                appearance: none !important; /* 隱藏下拉箭頭 */
                -webkit-appearance: none;
                padding: 0 5px !important;
                background: transparent !important;
            }

            /* 日曆表格調整 */
            .calendar-grid {
                border-left: 2px solid #000 !important;
                border-top: 2px solid #000 !important;
            }
            .day-header {
                background-color: #ddd !important; /* 列印改用灰色背景 */
                color: #000 !important;
                border-color: #000 !important;
                padding: 5px 0 !important;
                font-size: 11pt;
            }
            .day-cell {
                min-height: auto !important; /* 高度自動縮放 */
                height: 85px; /* 固定一個較小的高度以確保塞入 A4 */
                border-color: #000 !important;
                padding: 2px !important;
            }
            .day-cell.bg-indigo-50\/50, .day-cell.bg-gray-100 {
                background-color: #f5f5f5 !important; /* 週末和空白日用淺灰 */
            }
            .day-cell.skipped-day {
                background-color: #ddd !important; /* 列印時跳過的天數顏色 */
            }
            
            /* 輸入框改為純文字顯示效果 */
            input.time-input {
                border: none !important;
                padding: 0 !important;
                font-size: 9pt !important;
                height: auto !important;
                width: auto !important;
                background: transparent !important;
            }
            /* 隱藏 Checkbox 本體與標籤 */
            input[type="checkbox"], .skip-label {
                display: none !important;
            }
            
            /* 新增：列印時顯示的時數或休假文字 */
            .print-hours-display {
                display: block !important; /* 在列印時顯示 */
                font-size: 10pt;
                font-weight: bold;
                color: #000;
            }
            
            label {
                font-size: 8pt !important;
                color: #333 !important;
            }
            
            /* 統計區塊調整 */
            .summary-container {
                margin-top: 15px !important;
                padding: 10px !important;
                box-shadow: none !important;
                background: none !important;
                border: 2px solid #000 !important;
                border-radius: 0 !important;
            }
            .summary-header {
                display: none !important; /* 隱藏原本的「薪資統計」標題列，節省空間 */
            }
            .summary-grid {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 10px !important;
            }
            .summary-item {
                border: 1px solid #000 !important;
                box-shadow: none !important;
                padding: 5px !important;
                border-radius: 0 !important;
                background: white !important;
            }
            /* 強制顯示時薪輸入框的值 */
            input#hourlyRateInput {
                border: none !important;
                font-size: 14pt !important;
                font-weight: bold !important;
                color: #000 !important;
                padding: 0 !important;
                width: 100% !important;
                -webkit-appearance: none;
            }
            .summary-text {
                font-size: 14pt !important;
                color: #000 !important;
            }

            /* 簽名欄調整 */
            .signature-section {
                margin-top: 20px !important;
                border-top: none !important;
                padding-top: 0 !important;
            }
            .signature-row {
                margin-bottom: 20px !important;
            }
            .signature-label {
                font-size: 10pt !important;
                color: #000 !important;
            }
            .signature-line {
                border-bottom: 1px solid #000 !important;
            }
        }
    </style>
</head>
<body>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc, collection, query, getDocs, where, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase variables will be populated at runtime by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : undefined;

        // --- Global State and Initialization ---
        let db;
        let auth;
        let userId = null;
        let currentYear, currentMonth;
        let calendarData = {}; 
        let settingsDocRef;
        let hourlyRate = 0; 
        const DEFAULT_HOURLY_RATE = 190; 

        const today = new Date();
        currentYear = today.getFullYear();
        currentMonth = today.getMonth();

        setLogLevel('debug'); 

        function timeToMinutes(timeStr) {
            if (!timeStr) return 0;
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function calculateDuration(start, end) {
            const startMins = timeToMinutes(start);
            const endMins = timeToMinutes(end);
            if (endMins > startMins) {
                return (endMins - startMins) / 60;
            }
            return 0; 
        }

        function getDefaultTimes(dayOfWeek) {
            if ([1, 3, 4, 5].includes(dayOfWeek)) {
                return { start: '12:00', end: '18:00' };
            }
            if (dayOfWeek === 2) {
                return { start: '16:00', end: '18:00' };
            }
            return { start: '', end: '' };
        }

        function getCollectionPath() {
            if (!userId) {
                console.error("Firestore: User ID is missing.");
                return null;
            }
            return `artifacts/${appId}/users/${userId}/work_entries`;
        }
        
        function getSettingsDocRef(dbInstance, uid) {
             if (!uid) {
                console.error("Firestore: User ID is missing for settings.");
                return null;
            }
            return doc(dbInstance, `artifacts/${appId}/users/${uid}/settings`, 'calendar_settings');
        }

        async function saveDayData(dateKey, start, end, skipped) {
            const duration = calculateDuration(start, end);
            const data = {
                dateKey: dateKey,
                start: start,
                end: end,
                skipped: skipped, 
                duration: duration
            };

            if (start === '' && end === '' && !skipped) {
                delete calendarData[dateKey];
            } else {
                calendarData[dateKey] = data;
            }
            
            updateSummary();

            if (!db || !userId) {
                console.warn("User not logged in or DB not ready. Changes are local only.");
                return;
            }

            const collectionPath = getCollectionPath();
            if (!collectionPath) return;
            const docRef = doc(db, collectionPath, dateKey);

            try {
                if (start === '' && end === '' && !skipped) {
                    await deleteDoc(docRef);
                } else {
                    await setDoc(docRef, data);
                }
            } catch (error) {
                console.error("Error saving time entry:", error);
            }
        }

        async function saveHourlyRate() {
            if (!settingsDocRef) return;
            try {
                await setDoc(settingsDocRef, { hourlyRate: hourlyRate }, { merge: true });
            } catch (error) {
                console.error("Error saving hourly rate:", error);
            }
        }

        function setupDataListener() {
            if (!db || !userId) return;
            const collectionPath = getCollectionPath();
            if (!collectionPath) return;
            
            const yearMonth = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
            const q = query(collection(db, collectionPath), 
                where("dateKey", ">=", `${yearMonth}-01`), 
                where("dateKey", "<=", `${yearMonth}-31`)); 

            onSnapshot(q, (snapshot) => {
                calendarData = {}; 
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    calendarData[data.dateKey] = data;
                });
                renderCalendar(currentYear, currentMonth); 
                updateSummary(); 
            }, (error) => {
                console.error("Error setting up data listener:", error);
            });
            
            onSnapshot(settingsDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    hourlyRate = data.hourlyRate || DEFAULT_HOURLY_RATE;
                } else {
                    hourlyRate = DEFAULT_HOURLY_RATE;
                }
                const hourlyRateInput = document.getElementById('hourlyRateInput');
                if (hourlyRateInput) {
                     hourlyRateInput.value = hourlyRate;
                }
                updateSummary();
            }, (error) => {
                 console.error("Error setting up settings listener:", error);
            });
        }

        async function initializeAppAndAuth() {
            if (!firebaseConfig.apiKey) {
                console.warn("Firebase config is missing. Data persistence will not work.");
                initializeUI();
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        settingsDocRef = getSettingsDocRef(db, userId);
                        setupDataListener(); 
                    } else {
                        userId = null;
                    }
                    initializeUI();
                });

            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
                initializeUI(); 
            }
        }

        function initializeUI() {
            const monthSelector = document.getElementById('monthSelector');
            const yearSelector = document.getElementById('yearSelector');

            for (let i = 0; i < 12; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = (i + 1) + '月';
                monthSelector.appendChild(option);
            }
            
            for (let y = currentYear - 5; y <= currentYear + 5; y++) {
                const option = document.createElement('option');
                option.value = y;
                option.textContent = y + '年';
                yearSelector.appendChild(option);
            }

            monthSelector.value = currentMonth;
            yearSelector.value = currentYear;

            document.getElementById('prevMonthBtn').addEventListener('click', () => navigateMonth(-1));
            document.getElementById('nextMonthBtn').addEventListener('click', () => navigateMonth(1));
            monthSelector.addEventListener('change', handleDateChange);
            yearSelector.addEventListener('change', handleDateChange);
            
            const hourlyRateInput = document.getElementById('hourlyRateInput');
            
            hourlyRate = hourlyRate || DEFAULT_HOURLY_RATE;
            hourlyRateInput.value = hourlyRate;
            
            let saveRateTimeout;
            hourlyRateInput.addEventListener('input', (e) => {
                clearTimeout(saveRateTimeout);
                const newValue = parseFloat(e.target.value);
                if (isNaN(newValue) || newValue < 0) {
                     return;
                }
                hourlyRate = newValue;
                updateSummary(); 
                saveRateTimeout = setTimeout(() => {
                    if (userId) {
                        saveHourlyRate();
                    } 
                }, 1000);
            });

            if (!userId) {
                renderCalendar(currentYear, currentMonth);
                updateSummary();
            }
        }
        
        function navigateMonth(delta) {
            const date = new Date(currentYear, currentMonth + delta, 1);
            currentYear = date.getFullYear();
            currentMonth = date.getMonth();
            
            document.getElementById('monthSelector').value = currentMonth;
            document.getElementById('yearSelector').value = currentYear;
            
            if (userId) {
                setupDataListener(); 
            } else {
                renderCalendar(currentYear, currentMonth);
            }
        }
        
        function handleDateChange() {
             const newMonth = parseInt(document.getElementById('monthSelector').value);
             const newYear = parseInt(document.getElementById('yearSelector').value);
             
             if (currentMonth !== newMonth || currentYear !== newYear) {
                currentMonth = newMonth;
                currentYear = newYear;
                if (userId) {
                    setupDataListener(); 
                } else {
                    renderCalendar(currentYear, currentMonth);
                }
             }
        }

        function renderCalendar(year, month) {
            const calendarBody = document.getElementById('calendarBody');
            calendarBody.innerHTML = ''; 

            const firstDayOfMonth = new Date(year, month, 1).getDay(); 
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDayOfMonth; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'day-cell bg-gray-100';
                calendarBody.appendChild(emptyCell);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dayOfWeek = date.getDay(); 
                
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const savedData = calendarData[dateKey];
                
                let { start: defaultStart, end: defaultEnd } = getDefaultTimes(dayOfWeek);
                const startValue = savedData ? savedData.start : defaultStart;
                const endValue = savedData ? savedData.end : defaultEnd;
                const isSkipped = savedData && savedData.skipped ? true : false;
                
                const duration = calculateDuration(startValue, endValue);
                // 修改：列印時的文字，如果是跳過則顯示「休假」
                const printText = isSkipped ? "休假" : `${duration.toFixed(1)}小時`;
                
                const isWeekend = (dayOfWeek === 0 || dayOfWeek === 6);
                
                const cell = document.createElement('div');
                cell.id = `cell-${dateKey}`;
                const skippedClasses = isSkipped ? 'skipped-day' : '';
                const weekendClasses = isWeekend ? 'bg-indigo-50/50' : '';
                cell.className = `day-cell flex flex-col ${weekendClasses} ${skippedClasses}`;
                
                const dayName = ['日', '一', '二', '三', '四', '五', '六'][dayOfWeek];
                const dayHeader = `
                    <div class="flex justify-between items-center mb-1 md:mb-2">
                        <div class="flex items-center space-x-1">
                            <span class="text-lg md:text-xl font-bold text-indigo-700">${day}</span>
                            <span class="text-xs md:text-sm font-medium ${isWeekend ? 'text-red-500' : 'text-gray-600'}">週${dayName}</span>
                        </div>
                        <div class="flex items-center">
                             <input type="checkbox" id="skip-${dateKey}" data-date="${dateKey}" 
                                    class="mr-1 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded cursor-pointer"
                                    ${isSkipped ? 'checked' : ''}
                                    onchange="handleDataChange(this)">
                             <label for="skip-${dateKey}" class="text-xs text-gray-500 cursor-pointer select-none skip-label">跳過</label>
                             
                             <span id="print-hours-${dateKey}" class="hidden print-hours-display">
                                ${printText}
                             </span>
                        </div>
                    </div>
                `;

                // 修改：時間輸入容器與休假標籤容器
                const contentHtml = `
                    <div id="time-container-${dateKey}" class="space-y-0.5 md:space-y-1 ${isSkipped ? 'hidden' : 'block'}">
                        <div class="flex items-center space-x-1 md:space-x-2">
                            <label for="start-${dateKey}" class="text-xs text-gray-500 w-8 md:w-10 shrink-0">上班:</label>
                            <input type="time" id="start-${dateKey}" data-date="${dateKey}" data-type="start"
                                   value="${startValue}"
                                   class="time-input w-full p-0.5 md:p-1 border rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                   onchange="handleDataChange(this)"
                            >
                        </div>
                        <div class="flex items-center space-x-1 md:space-x-2">
                            <label for="end-${dateKey}" class="text-xs text-gray-500 w-8 md:w-10 shrink-0">下班:</label>
                            <input type="time" id="end-${dateKey}" data-date="${dateKey}" data-type="end"
                                   value="${endValue}"
                                   class="time-input w-full p-0.5 md:p-1 border rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                   onchange="handleDataChange(this)"
                            >
                        </div>
                    </div>
                    <div id="vacation-label-${dateKey}" class="flex-grow flex items-center justify-center ${isSkipped ? 'block' : 'hidden'}">
                        <span class="text-2xl font-bold text-gray-400 select-none">休假</span>
                    </div>
                `;
                
                cell.innerHTML = dayHeader + contentHtml;
                calendarBody.appendChild(cell);
            }
            
            updateSummary(); 
        }

        window.handleDataChange = function(element) {
            const dateKey = element.dataset.date;
            
            const startInput = document.getElementById(`start-${dateKey}`);
            const endInput = document.getElementById(`end-${dateKey}`);
            const skipInput = document.getElementById(`skip-${dateKey}`);
            const cell = document.getElementById(`cell-${dateKey}`);
            const printHoursSpan = document.getElementById(`print-hours-${dateKey}`);
            const timeContainer = document.getElementById(`time-container-${dateKey}`);
            const vacationLabel = document.getElementById(`vacation-label-${dateKey}`);
            
            const start = startInput.value;
            const end = endInput.value;
            const skipped = skipInput.checked;
            
            // 即時更新 UI
            if (skipped) {
                cell.classList.add('skipped-day');
                timeContainer.classList.replace('block', 'hidden');
                vacationLabel.classList.replace('hidden', 'block');
            } else {
                cell.classList.remove('skipped-day');
                timeContainer.classList.replace('hidden', 'block');
                vacationLabel.classList.replace('block', 'hidden');
            }

            const duration = calculateDuration(start, end);
            const printText = skipped ? "休假" : `${duration.toFixed(1)}小時`;
            if(printHoursSpan) {
                printHoursSpan.textContent = printText;
            }

            saveDayData(dateKey, start, end, skipped);
        }

        function updateSummary() {
            let totalDuration = 0;
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const savedData = calendarData[dateKey];
                
                let start, end, isSkipped = false;

                if (savedData) {
                    start = savedData.start;
                    end = savedData.end;
                    isSkipped = savedData.skipped || false;
                } else {
                    const date = new Date(currentYear, currentMonth, day);
                    const defaults = getDefaultTimes(date.getDay());
                    start = defaults.start;
                    end = defaults.end;
                }

                if (!isSkipped) {
                    totalDuration += calculateDuration(start, end);
                }
            }
            
            const totalSalary = totalDuration * hourlyRate;
            
            document.getElementById('totalHours').textContent = totalDuration.toFixed(2);
            document.getElementById('hourlyRateDisplay').textContent = hourlyRate.toFixed(2);
            document.getElementById('totalSalary').textContent = totalSalary.toFixed(0);
            
            const totalHoursAlt = document.getElementById('totalHours-alt');
            if (totalHoursAlt) totalHoursAlt.textContent = totalDuration.toFixed(2);
            
            const totalSalaryAlt = document.getElementById('totalSalary-alt');
            if (totalSalaryAlt) totalSalaryAlt.textContent = totalSalary.toFixed(0);

            const rateInput = document.getElementById('hourlyRateInput');
            if (rateInput && document.activeElement !== rateInput) {
                rateInput.value = hourlyRate.toFixed(0);
            }
        }
        
        window.updateSummary = updateSummary;
        window.printPage = function() { window.print(); }
        window.onload = initializeAppAndAuth;

    </script>

    <!-- Main Application Container -->
    <div class="max-w-6xl mx-auto p-4 md:p-8">
        
        <h1 class="text-3xl font-extrabold text-indigo-800 mb-6 border-b pb-2">每月工時與薪資日曆</h1>

        <!-- Month/Year Navigation -->
        <div class="nav-container flex flex-col md:flex-row items-center justify-between bg-white p-4 rounded-xl shadow-lg mb-6 space-y-4 md:space-y-0">
            <div class="flex items-center space-x-4">
                <button id="prevMonthBtn" class="month-nav-btn p-2 bg-indigo-500 text-white rounded-full hover:bg-indigo-600 transition duration-150">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <div class="text-2xl font-semibold text-gray-800 flex items-center space-x-2">
                     <select id="yearSelector" class="p-2 border rounded-md text-lg focus:ring-indigo-500 focus:border-indigo-500"></select>
                     <select id="monthSelector" class="p-2 border rounded-md text-lg focus:ring-indigo-500 focus:border-indigo-500"></select>
                </div>
                <button id="nextMonthBtn" class="month-nav-btn p-2 bg-indigo-500 text-white rounded-full hover:bg-indigo-600 transition duration-150">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>
        </div>

        <!-- Calendar Grid -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="calendar-grid">
                <div class="day-header bg-red-600">週日</div>
                <div class="day-header">週一</div>
                <div class="day-header">週二</div>
                <div class="day-header">週三</div>
                <div class="day-header">週四</div>
                <div class="day-header">週五</div>
                <div class="day-header bg-red-600">週六</div>
            </div>
            <div id="calendarBody" class="calendar-grid"></div>
        </div>
        
        <!-- Summary and Salary Calculation -->
        <div class="summary-container mt-8 bg-indigo-50 p-6 rounded-xl shadow-lg">
            <div class="summary-header flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 border-b border-indigo-300 pb-2">
                <h2 class="text-2xl font-bold text-indigo-800">薪資統計</h2>
                <div class="flex space-x-2">
                    <button type="button" onclick="updateSummary()" class="mt-2 sm:mt-0 flex items-center space-x-1 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition duration-150 shadow-md active:scale-95 transform">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                        <span>重新計算總時數</span>
                    </button>
                    <button type="button" onclick="printPage()" class="mt-2 sm:mt-0 flex items-center space-x-1 px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-lg hover:bg-gray-700 transition duration-150 shadow-md active:scale-95 transform">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                        <span>列印本頁 (A4)</span>
                    </button>
                </div>
            </div>
            
            <div class="summary-grid grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="summary-item bg-white p-4 rounded-lg shadow-md border-l-4 border-indigo-500">
                    <label for="hourlyRateInput" class="block text-sm font-medium text-gray-700 mb-2">時薪 (元)</label>
                    <input type="number" id="hourlyRateInput" value="190" min="0" step="1"
                           class="w-full text-2xl font-bold text-indigo-700 p-2 border-2 border-indigo-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150"
                           placeholder="輸入時薪">
                </div>
                <div class="summary-item bg-white p-4 rounded-lg shadow-md border-l-4 border-green-500 flex flex-col justify-center">
                    <p class="text-sm font-medium text-gray-700">總時數 (小時)</p>
                    <p class="text-4xl font-extrabold text-green-700 summary-text"><span id="totalHours">0.00</span></p>
                </div>
                <div class="summary-item bg-white p-4 rounded-lg shadow-md border-l-4 border-red-500 flex flex-col justify-center">
                    <p class="text-sm font-medium text-gray-700">總薪資 (元)</p>
                    <p class="text-4xl font-extrabold text-red-700 summary-text"><span id="totalSalary">0</span></p>
                </div>
            </div>
            
             <p class="mt-4 text-sm text-gray-600 text-center no-print">計算公式：總時數 (<span id="totalHours-alt">0.00</span>) × 時薪 (<span id="hourlyRateDisplay">0</span>) = 總薪資 (<span id="totalSalary-alt">0</span>)</p>

            <div class="signature-section mt-12 border-t-2 border-indigo-200 pt-8 print:border-gray-300">
                <div class="signature-row flex flex-col md:flex-row justify-between items-end gap-6">
                    <div class="flex items-end w-full">
                        <span class="signature-label text-lg font-bold text-gray-700 whitespace-nowrap mr-2">員工姓名：</span>
                        <div class="signature-line border-b-2 border-gray-400 flex-grow h-8"></div>
                    </div>
                    <div class="flex items-end w-full">
                        <span class="signature-label text-lg font-bold text-gray-700 whitespace-nowrap mr-2">管理者：</span>
                        <div class="signature-line border-b-2 border-gray-400 flex-grow h-8"></div>
                    </div>
                    <div class="flex items-end w-full">
                        <span class="signature-label text-lg font-bold text-gray-700 whitespace-nowrap mr-2">主管簽名：</span>
                        <div class="signature-line border-b-2 border-gray-400 flex-grow h-8"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
